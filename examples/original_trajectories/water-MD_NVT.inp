@SET SYSNAME water-MD_NVT
! When infos are written
@SET STDPRINT 1
@SET TRAJMDPRINT 10
! When restart are written
@SET RSTSCF 100
@SET RSTMD 100
! Name of EXT_RESTART files (MD and/or SCF)
@SET OLDRESTARTMD water-GEO_OPT.restart
@SET OLDRESTARTSCF water-GEO_OPT.wfn

&GLOBAL
 PRINT_LEVEL LOW
 PREFERRED_FFT_LIBRARY FFTW3
 EXTENDED_FFT_LENGTHS TRUE
 PROJECT ${SYSNAME}
 RUN_TYPE MD
 WALLTIME 19:30:00
&END GLOBAL
&MOTION
 &MD
  ENSEMBLE NVT
  STEPS 100
  TIMESTEP [fs] 0.5
  TEMPERATURE [K] 300.0
  &THERMOSTAT
   TYPE CSVR
   REGION GLOBAL
   &CSVR
    TIMECON [fs] 10.0
   &END CSVR
  &END THERMOSTAT
  &PRINT
   &ENERGY
    FILENAME =${SYSNAME}-Energy.en
    LOG_PRINT_KEY
    &EACH
     MD ${STDPRINT}
    &END EACH
    ADD_LAST NUMERIC
   &END ENERGY
   &PROGRAM_RUN_INFO
    FILENAME =${SYSNAME}-Motion.log
    LOG_PRINT_KEY
    &EACH
     MD ${STDPRINT}
    &END EACH
    ADD_LAST NUMERIC
   &END PROGRAM_RUN_INFO
  &END PRINT
 &END MD
 &PRINT
  &TRAJECTORY
   FORMAT XYZ
   UNIT angstrom
   FILENAME =${SYSNAME}-Trajectory.xyz
   LOG_PRINT_KEY
   &EACH
    MD ${TRAJMDPRINT}
   &END EACH
   ADD_LAST NUMERIC
  &END TRAJECTORY
  &RESTART
   FILENAME =${SYSNAME}.restart
   LOG_PRINT_KEY
   &EACH
    MD ${RSTMD}
   &END EACH
   ADD_LAST NUMERIC
  &END RESTART
  &VELOCITIES OFF
  &END VELOCITIES
  &CELL
   FILENAME =${SYSNAME}-Cell.cell
   LOG_PRINT_KEY
   &EACH
    MD ${TRAJMDPRINT}
   &END EACH
   ADD_LAST NUMERIC
  &END CELL
  &RESTART_HISTORY ON
   FILENAME MD
   LOG_PRINT_KEY
   &EACH
    MD ${RSTMD}
   &END EACH
   ADD_LAST NUMERIC
  &END RESTART_HISTORY
 &END PRINT
&END MOTION
&FORCE_EVAL
 METHOD QS
 &DFT
  BASIS_SET_FILE_NAME BASIS_MOLOPT
  POTENTIAL_FILE_NAME GTH_POTENTIALS
  WFN_RESTART_FILE_NAME ${OLDRESTARTSCF}
  CHARGE 0
  MULTIPLICITY 1
  &MGRID
   SKIP_LOAD_BALANCE_DISTRIBUTED FALSE
   CUTOFF [Ry] 400.0
  &END MGRID
  &SCF
   MAX_SCF 30
   EPS_SCF 1e-6
   SCF_GUESS RESTART
   &OUTER_SCF
    EPS_SCF 1e-6
    MAX_SCF 10
   &END OUTER_SCF
   &OT
    PRECONDITIONER FULL_SINGLE_INVERSE
    MINIMIZER DIIS
    N_DIIS 5
   &END OT
   &PRINT
    &RESTART
     FILENAME SCF
     LOG_PRINT_KEY
     BACKUP_COPIES 0
     &EACH
      MD ${RSTSCF}
     &END EACH
     COMMON_ITERATION_LEVELS 1
     ADD_LAST NUMERIC
    &END RESTART
    &RESTART_HISTORY OFF
    &END RESTART_HISTORY
   &END PRINT
  &END SCF
  &QS
   METHOD GPW
   EPS_DEFAULT 1.0E-10
   EXTRAPOLATION ASPC
   EXTRAPOLATION_ORDER 4
  &END QS
  &XC
   DENSITY_CUTOFF 1.0E-10
   GRADIENT_CUTOFF 1.0E-10
   &XC_GRID
    XC_SMOOTH_RHO NN50
    XC_DERIV NN50_SMOOTH
   &END XC_GRID
   &XC_FUNCTIONAL BLYP
   &END XC_FUNCTIONAL
   &VDW_POTENTIAL
    POTENTIAL_TYPE PAIR_POTENTIAL
    &PAIR_POTENTIAL
     R_CUTOFF [angstrom] 15.0
     TYPE DFTD3
     PARAMETER_FILE_NAME dftd3.dat
     REFERENCE_FUNCTIONAL BLYP
     VERBOSE_OUTPUT
    &END PAIR_POTENTIAL
   &END VDW_POTENTIAL
  &END XC
  &POISSON
   POISSON_SOLVER PERIODIC
   PERIODIC XYZ
  &END POISSON
  &PRINT
   &MULLIKEN OFF
   &END MULLIKEN
  &END PRINT
 &END DFT
 STRESS_TENSOR ANALYTICAL
 &SUBSYS
  &CELL
   ABC [angstrom] 19.7340 19.7340 19.7340
   ALPHA_BETA_GAMMA [deg] 90.0 90.0 90.0
   PERIODIC XYZ
   SYMMETRY CUBIC
  &END CELL
  &TOPOLOGY
   COORD_FILE_FORMAT XYZ
   COORD_FILE_NAME water-GEO_OPT.xyz
  &END TOPOLOGY
  &KIND O
   BASIS_SET DZVP-MOLOPT-SR-GTH
   POTENTIAL GTH-BLYP-q6
  &END KIND
  &KIND H
   BASIS_SET DZVP-MOLOPT-SR-GTH
   POTENTIAL GTH-BLYP-q1
  &END KIND
 &END SUBSYS
 &PRINT
  &PROGRAM_RUN_INFO
   LOG_PRINT_KEY
   &EACH
    MD ${STDPRINT}
   &END EACH
   ADD_LAST NUMERIC
  &END PROGRAM_RUN_INFO
  &FORCES
   FILENAME =${SYSNAME}-Forces.for
   LOG_PRINT_KEY
   &EACH
    MD ${TRAJMDPRINT}
   &END EACH
   ADD_LAST NUMERIC
  &END FORCES
 &END PRINT
&END FORCE_EVAL
#&EXT_RESTART
# RESTART_DEFAULT FALSE
# RESTART_COUNTERS TRUE
# RESTART_AVERAGES TRUE
# RESTART_VEL TRUE
# RESTART_POS TRUE
# RESTART_RANDOMG TRUE
# RESTART_THERMOSTAT TRUE
# RESTART_BAROSTAT TRUE
# RESTART_BAROSTAT_THERMOSTAT TRUE
# RESTART_CELL TRUE
# RESTART_METADYNAMICS TRUE
# RESTART_CONSTRAINTS TRUE
# RESTART_FILE_NAME ${OLDRESTARTMD}
#&END EXT_RESTART
